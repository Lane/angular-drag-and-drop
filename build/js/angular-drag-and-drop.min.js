var module;module=angular.module("laneolson.ui.dragdrop",[]),module.directive("dragAndDrop",["$document",function(t){return{restrict:"AE",scope:{onItemPlaced:"&",onItemRemoved:"&",onDrag:"&",onDragStart:"&",onDragEnd:"&",onDragEnter:"&",onDragLeave:"&",enableSwap:"=",fixedPositions:"="},require:"dragAndDrop",controller:["$q","$scope",function(t,e){var r,n,o,a,i;e.draggables=n=[],e.droppables=o=[],e.isDragging=!1,e.currentDraggable=null,r=null,a=function(t,e){var r,n;return e.left<(r=t[0])&&r<e.right&&e.top<(n=t[1])&&n<e.bottom},i=function(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)},this.checkForIntersection=function(){var t,r,n,i;for(i=[],r=0,n=o.length;n>r;r++)t=o[r],a(e.currentDraggable.midPoint,t)?t.isActive?i.push(void 0):(this.setCurrentDroppable(t),t.activate(),i.push(this.fireCallback("drag-enter"))):t.isActive?(this.setCurrentDroppable(null),t.deactivate(),i.push(this.fireCallback("drag-leave"))):i.push(void 0);return i},this.setCurrentDraggable=function(t){return e.currentDraggable=t,t&&this.fireCallback("drag-start"),e.$evalAsync(function(){return e.currentDraggable=t,t?e.isDragging=!0:e.isDragging=!1})},this.getCurrentDraggable=function(){return e.currentDraggable},this.setCurrentDroppable=function(t){return r=t},this.getCurrentDroppable=function(){return r},this.addDroppable=function(t){return o.push(t)},this.addDraggable=function(t){return n.push(t)},this.fireCallback=function(t){var r;switch(r={draggable:this.getCurrentDraggable(),droppable:this.getCurrentDroppable()},t){case"drag-end":return"function"==typeof e.onDragEnd?e.onDragEnd(r):void 0;case"drag-start":return"function"==typeof e.onDragStart?e.onDragStart(r):void 0;case"drag":return"function"==typeof e.onDrag?e.onDrag(r):void 0;case"item-assigned":return"function"==typeof e.onItemPlaced?e.onItemPlaced(r):void 0;case"item-removed":return"function"==typeof e.onItemRemoved?e.onItemRemoved(r):void 0;case"drag-leave":return"function"==typeof e.onDragLeave?e.onDragLeave(r):void 0;case"drag-enter":return"function"==typeof e.onDragEnter?e.onDragEnter(r):void 0}}}],link:function(e,r,n,o){var a,i,s,u,l,d;return i="touchmove mousemove",l="touchend mouseup",a=function(){return t.on(i,s),t.on(l,u)},d=function(){return t.off(i,s),t.off(l,u)},u=function(t){var n,a;return n=o.getCurrentDraggable(),a=o.getCurrentDroppable(),n?(r.addClass("drag-return"),setTimeout(function(){return r.removeClass("drag-return")},500),o.fireCallback("drag-end"),n.deactivate(),a&&!a.isFull?(o.fireCallback("item-assigned"),n.assignTo(a),a.itemDropped(n)):a&&a.isFull&&e.enableSwap?(a.items[0].returnToStartPosition(),a.items[0].removeFrom(a),o.fireCallback("item-assigned"),n.assignTo(a),a.itemDropped(n),o.fireCallback("item-removed")):(n.isAssigned=!1,e.fixedPositions&&n.returnToStartPosition()),a&&a.deactivate(),o.setCurrentDraggable(null)):void 0},s=function(t){var e;return e=o.getCurrentDraggable(),e?(o.fireCallback("drag"),t.touches&&1===t.touches.length?e.updateOffset(t.touches[0].clientX,t.touches[0].clientY):e.updateOffset(t.clientX,t.clientY),o.checkForIntersection()):void 0},a()}}}]),module.directive("dragItem",["$window","$document",function(t,e){return{restrict:"EA",require:"^dragAndDrop",transclude:!0,template:"<div class='drag-transform' ng-class='{ dropped: isAssigned}' ><div class='drag-content' ng-transclude></div></div>",scope:{x:"@",y:"@",dropTo:"@",dragId:"@",dragData:"=",clone:"=",lockHorizontal:"=",lockVertical:"="},link:function(e,r,n,o){var a,i,s,u,l,d,c,f,p,g,m,v,h;return e.dragId&&r.addClass(e.dragId),e.clone?(i=angular.element(r[0].cloneNode(!0)),r.parent().append(i),i.addClass("clone"),p=i):p=r,s=[0,0],h=r[0].offsetWidth,u=r[0].offsetHeight,e.dropSpots=[],e.isAssigned=!1,null==e.x&&(e.x=0),null==e.y&&(e.y=0),f=[e.x,e.y],m=function(){return e.left=e.x+r[0].offsetLeft,e.right=e.left+h,e.top=e.y+r[0].offsetTop,e.bottom=e.top+u,e.midPoint=[e.left+h/2,e.top+u/2],e.lockVertical?(e.percent=100*(e.left+r[0].clientWidth/2)/r.parent()[0].clientWidth,e.percent=Math.min(100,Math.max(0,e.percent))):void 0},c=function(){var t;return t=r[0].getBoundingClientRect(),p.css({position:"absolute",top:t.top+"px",left:t.left+"px",bottom:"auto",right:"auto",transform:"translate(0,0)","-webkit-transform":"translate(0,0)","-ms-transform":"translate(0,0)"})},e.setPercentPostion=function(t,n){var o,a;return a=r.parent()[0].clientHeight*(n/100)-r[0].clientHeight/2,o=r.parent()[0].clientWidth*(t/100)-r[0].clientWidth/2,e.setPosition(o,a)},e.setPosition=function(t,r){return e.x=e.lockHorizontal?0:t,e.y=e.lockVertical?0:r,m(),p.css({transform:"translate("+e.x+"px, "+e.y+"px)","-webkit-transform":"translate("+e.x+"px, "+e.y+"px)","-ms-transform":"translate("+e.x+"px, "+e.y+"px)"})},e.updateOffset=function(t,n){return e.setPosition(t-(s[0]+r[0].offsetLeft),n-(s[1]+r[0].offsetTop))},e.returnToStartPosition=function(){return e.setPosition(f[0],f[1])},e.assignTo=function(t){return e.dropSpots.push(t),e.isAssigned=!0,t.dropId?r.addClass("in-"+t.dropId):void 0},e.removeFrom=function(t){var n;return n=e.dropSpots.indexOf(t),n>-1?(t.dropId&&r.removeClass("in-"+t.dropId),e.dropSpots.splice(n,1),e.dropSpots.length<1&&(e.isAssigned=!1),t.removeItem(e)):void 0},e.activate=function(){return r.addClass("drag-active"),e.isDragging=!0},e.deactivate=function(){return s=[0,0],e.clone&&i.removeClass("clone-active"),r.removeClass("drag-active"),e.isDragging=!1},a=function(){return r.on(d,l),v.bind("resize",m)},g=function(){return r.off(d,l),v.unbind("resize",m)},l=function(t){var r,n,a,u,l;for(e.clone&&(e.returnToStartPosition(),i.addClass("clone-active"),c()),o.setCurrentDraggable(e),e.activate(),e.isAssigned=!1,s=t.touches&&1===t.touches.length?[t.touches[0].clientX-e.left,t.touches[0].clientY-e.top]:[t.offsetX,t.offsetY],o.checkForIntersection(),r=o.getCurrentDroppable(),u=e.dropSpots,n=0,a=u.length;a>n;n++)l=u[n],e.removeFrom(l),o.fireCallback("item-removed");return t.preventDefault()},d="touchstart mousedown",v=angular.element(t),m(),o.addDraggable(e),a(),e.returnToStartPosition(),e.$emit("drag-ready",e),e.$on("$destroy",function(){return g()})}}}]),module.directive("dropSpot",["$window",function(t){return{restrict:"AE",require:"^dragAndDrop",transclude:!0,template:"<div class='drop-content' ng-class='{ \"drop-full\": isFull }' ng-transclude></div>",scope:{dropId:"@",maxItems:"="},link:function(e,r,n,o){var a,i,s,u,l,d,c;return d=function(){return e.left=r[0].offsetLeft,e.top=r[0].offsetTop,e.right=e.left+r[0].offsetWidth,e.bottom=e.top+r[0].offsetHeight},s=function(t){var r,n,o,a;switch(r=[e.right-e.left,e.bottom-e.top],n=[t.right-t.left,t.bottom-t.top],t.dropTo){case"top":o=e.left+(r[0]-n[0])/2,a=e.top;break;case"bottom":o=e.left+(r[0]-n[0])/2,a=e.top+(r[1]-n[1]);break;case"left":o=e.left,a=e.top+(r[1]-n[1])/2;break;case"right":o=e.left+(r[0]-n[0]),a=e.top+(r[1]-n[1])/2;break;case"top left":o=e.left,a=e.top;break;case"bottom right":o=e.left+(r[0]-n[0]),a=e.top+(r[1]-n[1]);break;case"bottom left":o=e.left,a=e.top+(r[1]-n[1]);break;case"top right":o=e.left+(r[0]-n[0]),a=e.top;break;case"center":o=e.left+(r[0]-n[0])/2,a=e.top+(r[1]-n[1])/2;break;default:t.dropOffset&&(o=e.left+t.dropOffset[0],a=e.top+t.dropOffset[1])}return[o,a]},e.itemDropped=function(t){var r,n;return r=a(t),r?t.dropTo?(n=s(t),t.updateOffset(n[0],n[1])):t.dropOffset=[t.left-e.left,t.top-e.top]:e.fixedPositions?t.returnToStartPosition():void 0},a=function(t){return e.isFull?!1:(e.items.push(t),e.items.length>=e.maxItems&&(e.isFull=!0),t)},e.removeItem=function(t){var r;return r=e.items.indexOf(t),r>-1&&(e.items.splice(r,1),e.items.length<e.maxItems)?e.isFull=!1:void 0},e.activate=function(){return e.isActive=!0,r.addClass("drop-hovering")},e.deactivate=function(){return e.isActive=!1,o.setCurrentDroppable(null),r.removeClass("drop-hovering")},u=function(){var t,r,n,o,a,i;for(d(),a=e.items,i=[],t=0,n=a.length;n>t;t++)r=a[t],o=s(r),i.push(r.updateOffset(o[0],o[1]));return i},i=function(){return c.bind("resize",u)},l=function(){return c.unbind("resize",u)},e.dropId&&r.addClass(e.dropId),c=angular.element(t),i(),e.$on("$destroy",function(){return l()}),d(),e.isActive=!1,e.items=[],o.addDroppable(e)}}}]);