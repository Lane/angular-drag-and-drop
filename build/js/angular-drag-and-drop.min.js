var module;module=angular.module("laneolson.ui.dragdrop",[]),module.directive("dragAndDrop",["$document",function(t){return{restrict:"AE",scope:{onItemPlaced:"&",onItemRemoved:"&",onDrag:"&",onDragStart:"&",onDragEnd:"&",onDragEnter:"&",onDragLeave:"&",enableSwap:"=",fixedPositions:"="},require:"dragAndDrop",controller:["$q","$scope",function(t,e){var r,n,o,a,i,s,u,l;e.draggables=n=[],e.droppables=o=[],e.isDragging=!1,e.currentDraggable=null,r=null,a=null,l=!1,i=[],s=function(t,e){var r,n;return e.left<(r=t[0])&&r<e.right&&e.top<(n=t[1])&&n<e.bottom},u=function(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)},this.on=function(t,e){return"ready"===t&&l&&e(),i.push({name:t,cb:e})},this.trigger=function(t){var e,r,n,o;for("ready"===t&&(l=!0),o=[],r=0,n=i.length;n>r;r++)e=i[r],e.name===t?o.push(e.cb()):o.push(void 0);return o},this.isReady=function(){return l},this.setDragAndDropElement=function(t){return a=t},this.getDragAndDropElement=function(){return a},this.checkForIntersection=function(){var t,r,n,a;for(a=[],r=0,n=o.length;n>r;r++)t=o[r],s(e.currentDraggable.midPoint,t)?t.isActive?a.push(void 0):(this.setCurrentDroppable(t),t.activate(),a.push(this.fireCallback("drag-enter"))):t.isActive?(this.setCurrentDroppable(null),t.deactivate(),a.push(this.fireCallback("drag-leave"))):a.push(void 0);return a},this.setCurrentDraggable=function(t){return e.currentDraggable=t,t&&this.fireCallback("drag-start"),e.$evalAsync(function(){return e.currentDraggable=t,t?e.isDragging=!0:e.isDragging=!1})},this.getCurrentDraggable=function(){return e.currentDraggable},this.setCurrentDroppable=function(t){return r=t},this.getCurrentDroppable=function(){return r},this.addDroppable=function(t){return o.push(t)},this.addDraggable=function(t){return n.push(t)},this.fireCallback=function(t,r){var n;switch(n={draggable:this.getCurrentDraggable(),droppable:this.getCurrentDroppable(),dragEvent:r},t){case"drag-end":return"function"==typeof e.onDragEnd&&e.onDragEnd(n),this.trigger("drag-end");case"drag-start":return"function"==typeof e.onDragStart&&e.onDragStart(n),this.trigger("drag-start");case"drag":return"function"==typeof e.onDrag?e.onDrag(n):void 0;case"item-assigned":return"function"==typeof e.onItemPlaced?e.onItemPlaced(n):void 0;case"item-removed":return"function"==typeof e.onItemRemoved?e.onItemRemoved(n):void 0;case"drag-leave":return"function"==typeof e.onDragLeave?e.onDragLeave(n):void 0;case"drag-enter":return"function"==typeof e.onDragEnter?e.onDragEnter(n):void 0}}}],link:function(e,r,n,o){var a,i,s,u,l,d;return i="touchmove mousemove",l="touchend mouseup",o.setDragAndDropElement(r),a=function(){return t.on(i,s),t.on(l,u),o.on("drag-start",function(){return r.addClass("dragging")}),o.on("drag-end",function(){return r.removeClass("dragging")})},d=function(){return t.off(i,s),t.off(l,u)},u=function(t){var n,a;return n=o.getCurrentDraggable(),a=o.getCurrentDroppable(),n?(r.addClass("drag-return"),setTimeout(function(){return r.removeClass("drag-return")},500),o.fireCallback("drag-end",t),n.deactivate(),a&&!a.isFull?(o.fireCallback("item-assigned",t),n.assignTo(a),a.itemDropped(n)):a&&a.isFull&&e.enableSwap?(a.items[0].returnToStartPosition(),a.items[0].removeFrom(a),o.fireCallback("item-assigned",t),n.assignTo(a),a.itemDropped(n),o.fireCallback("item-removed",t)):(n.isAssigned=!1,e.fixedPositions&&n.returnToStartPosition()),a&&a.deactivate(),o.setCurrentDraggable(null)):void 0},s=function(t){var e;return e=o.getCurrentDraggable(),e?(o.fireCallback("drag",t),t.touches&&1===t.touches.length?e.updateOffset(t.touches[0].clientX,t.touches[0].clientY):e.updateOffset(t.clientX,t.clientY),o.checkForIntersection()):void 0},a(),o.trigger("ready")}}}]),module.directive("dragItem",["$window","$document","$compile",function(t,e,r){return{restrict:"EA",require:"^dragAndDrop",scope:{x:"@",y:"@",dropTo:"@",dragId:"@",dragEnabled:"=",dragData:"=",clone:"=",lockHorizontal:"=",lockVertical:"="},link:function(e,n,o,a){var i,s,u,l,d,c,f,g,p,m,v,h,b,D;return s=D=l=p=m=u=f=b=null,h=function(){return e.left=e.x+n[0].offsetLeft,e.right=e.left+D,e.top=e.y+n[0].offsetTop,e.bottom=e.top+l,e.midPoint=[e.left+D/2,e.top+l/2],e.lockVertical?(e.percent=100*(e.left+n[0].clientWidth/2)/n.parent()[0].clientWidth,e.percent=Math.min(100,Math.max(0,e.percent))):void 0},g=function(){var t,r,o;return t=n[0].getBoundingClientRect(),r=t.left+u[0],o=t.top+u[1],e.updateOffset(r,o)},e.setPercentPostion=function(t,r){var o,a;return a=n.parent()[0].clientHeight*(r/100)-n[0].clientHeight/2,o=n.parent()[0].clientWidth*(t/100)-n[0].clientWidth/2,e.setPosition(o,a)},e.setPosition=function(t,r){return e.x=e.lockHorizontal?0:t,e.y=e.lockVertical?0:r,h(),m.css({transform:"translate("+e.x+"px, "+e.y+"px)","-webkit-transform":"translate("+e.x+"px, "+e.y+"px)","-ms-transform":"translate("+e.x+"px, "+e.y+"px)"})},e.updateOffset=function(t,r){return e.clone?e.setPosition(t-(u[0]+n[0].offsetLeft),r-(u[1]+n[0].offsetTop)):e.setPosition(t-(u[0]+n[0].offsetLeft),r-(u[1]+n[0].offsetTop))},e.returnToStartPosition=function(){return e.setPosition(p[0],p[1])},e.assignTo=function(t){return e.dropSpots.push(t),e.isAssigned=!0,t.dropId?n.addClass("in-"+t.dropId):void 0},e.removeFrom=function(t){var r;return r=e.dropSpots.indexOf(t),r>-1?(t.dropId&&n.removeClass("in-"+t.dropId),e.dropSpots.splice(r,1),e.dropSpots.length<1&&(e.isAssigned=!1),t.removeItem(e)):void 0},e.addClass=function(t){return n.addClass(t)},e.removeClass=function(t){return n.removeClass(t)},e.toggleClass=function(t){return n.hasClass(t)?n.removeClass(t):n.addClass(t)},e.activate=function(){return n.addClass("drag-active"),e.isDragging=!0},e.deactivate=function(){return u=[0,0],e.clone&&s.removeClass("clone-active"),n.removeClass("drag-active"),e.isDragging=!1},i=function(){return n.on(f,c),b.bind("resize",h)},v=function(){return n.off(f,c),b.unbind("resize",h)},c=function(t){var r,o,i,l,d,c;if(e.dragEnabled){for(t.touches&&1===t.touches.length?u=[t.touches[0].clientX-e.left,t.touches[0].clientY-e.top]:(o=n[0].getBoundingClientRect(),u=[t.clientX-o.left,t.clientY-o.top]),e.clone&&(e.returnToStartPosition(),s.addClass("clone-active"),g()),a.setCurrentDraggable(e),e.activate(),e.isAssigned=!1,a.checkForIntersection(),r=a.getCurrentDroppable(),d=e.dropSpots,i=0,l=d.length;l>i;i++)c=d[i],e.removeFrom(c),a.fireCallback("item-removed",t);return t.preventDefault()}},d=function(){var o;return e.dragId&&n.addClass(e.dragId),u=[0,0],D=n[0].offsetWidth,l=n[0].offsetHeight,e.dropSpots=[],e.isAssigned=!1,null==e.x&&(e.x=0),null==e.y&&(e.y=0),p=[e.x,e.y],f="touchstart mousedown",b=angular.element(t),h(),a.addDraggable(e),i(),e.dragData&&angular.extend(e,e.dragData),e.clone?(e[e.dragData.key]=e.dragData.value,o=r(angular.element("<div>"+n.html()+"</div>"))(e),s=o,s.addClass("clone"),s.addClass(n.attr("class")),angular.element(a.getDragAndDropElement()).append(s),m=s):m=n,e.returnToStartPosition(),e.$emit("drag-ready",e),e.$on("$destroy",function(){return v()})},a.on("ready",d)}}}]),module.directive("dropSpot",["$window",function(t){return{restrict:"AE",require:"^dragAndDrop",transclude:!0,template:"<div class='drop-content' ng-class='{ \"drop-full\": isFull }' ng-transclude></div>",scope:{dropId:"@",maxItems:"="},link:function(e,r,n,o){var a,i,s,u,l,d,c;return d=function(){return e.left=r[0].offsetLeft,e.top=r[0].offsetTop,e.right=e.left+r[0].offsetWidth,e.bottom=e.top+r[0].offsetHeight},s=function(t){var r,n,o,a;switch(r=[e.right-e.left,e.bottom-e.top],n=[t.right-t.left,t.bottom-t.top],t.dropTo){case"top":o=e.left+(r[0]-n[0])/2,a=e.top;break;case"bottom":o=e.left+(r[0]-n[0])/2,a=e.top+(r[1]-n[1]);break;case"left":o=e.left,a=e.top+(r[1]-n[1])/2;break;case"right":o=e.left+(r[0]-n[0]),a=e.top+(r[1]-n[1])/2;break;case"top left":o=e.left,a=e.top;break;case"bottom right":o=e.left+(r[0]-n[0]),a=e.top+(r[1]-n[1]);break;case"bottom left":o=e.left,a=e.top+(r[1]-n[1]);break;case"top right":o=e.left+(r[0]-n[0]),a=e.top;break;case"center":o=e.left+(r[0]-n[0])/2,a=e.top+(r[1]-n[1])/2;break;default:t.dropOffset&&(o=e.left+t.dropOffset[0],a=e.top+t.dropOffset[1])}return[o,a]},e.itemDropped=function(t){var r,n;return r=a(t),r?t.dropTo?(n=s(t),t.updateOffset(n[0],n[1])):t.dropOffset=[t.left-e.left,t.top-e.top]:e.fixedPositions?t.returnToStartPosition():void 0},a=function(t){return e.isFull?!1:(e.items.push(t),e.items.length>=e.maxItems&&(e.isFull=!0),t)},e.removeItem=function(t){var r;return r=e.items.indexOf(t),r>-1&&(e.items.splice(r,1),e.items.length<e.maxItems)?e.isFull=!1:void 0},e.activate=function(){return e.isActive=!0,r.addClass("drop-hovering")},e.deactivate=function(){return e.isActive=!1,o.setCurrentDroppable(null),r.removeClass("drop-hovering")},u=function(){var t,r,n,o,a,i;for(d(),a=e.items,i=[],t=0,n=a.length;n>t;t++)r=a[t],o=s(r),i.push(r.updateOffset(o[0],o[1]));return i},i=function(){return c.bind("resize",u)},l=function(){return c.unbind("resize",u)},e.dropId&&r.addClass(e.dropId),c=angular.element(t),i(),e.$on("$destroy",function(){return l()}),d(),e.isActive=!1,e.items=[],o.addDroppable(e)}}}]);